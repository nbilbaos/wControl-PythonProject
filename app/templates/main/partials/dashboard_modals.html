<div class="modal fade" id="weightModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Nuevo Registro</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form action="{{ url_for('main.add_weight_entry') }}" method="POST">
          <div class="modal-body">
            <div class="mb-3">
                <label class="form-label">Peso (kg)</label>
                <input type="number" step="0.1" class="form-control form-control-lg" name="weight" id="weightInput" placeholder="Ej: 75.5" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Fecha</label>
                <input type="date" class="form-control" name="date" id="dateInput" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="editWeightModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Editar Registro</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form id="editForm" method="POST">
          <div class="modal-body">
            <input type="hidden" name="next" value="dashboard">

            <div class="mb-3">
                <label class="form-label">Peso (kg)</label>
                <input type="number" step="0.1" class="form-control" name="weight" id="editWeightInput" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Fecha</label>
                <input type="date" class="form-control" name="date" id="editDateInput" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
          </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="deleteWeightModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Confirmar Eliminación</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center py-4">
        <i class="bi bi-exclamation-triangle-fill text-warning display-4 mb-3"></i>
        <p class="mb-1">¿Estás seguro de que deseas eliminar el registro del día:</p>
        <h5 id="deleteDateText" class="fw-bold"></h5>
        <p class="text-danger small mt-3 mb-0">Esta acción no se puede deshacer.</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancelar</button>
        <form id="deleteForm" method="POST">
            <input type="hidden" name="next" value="dashboard">
            <button type="submit" class="btn btn-danger px-4">Eliminar</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="achievementModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg text-center" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
            <div class="modal-header border-0 justify-content-end pb-0">
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body pb-5 pt-0">
                <div class="mb-4 achievement-bounce">
                    <i id="modalIcon" class="bi display-1"></i>
                </div>
                <h2 class="fw-bold text-dark mb-3">¡Nuevo Logro Desbloqueado!</h2>
                <h4 id="modalTitle" class="fw-bold mb-3 text-uppercase"></h4>
                <p class="text-muted px-4">Has demostrado una constancia increíble.</p>
                <button type="button" class="btn btn-primary rounded-pill px-5 mt-3 shadow-sm" data-bs-dismiss="modal">¡Genial!</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="chartSettingsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">

        <h5 class="modal-title">Configurar Gráfico</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="chartOptionsForm">
            <div class="mb-3">
                <label class="form-label">Rango de Tiempo</label>
                <select class="form-select" id="timeFilter" onchange="toggleCustomDate()">
                    <option value="1m">Último Mes</option>
                    <option value="3m">Últimos 3 Meses</option>
                    <option value="all">Todo el historial</option>
                    <option value="custom">Rango Personalizado</option>
                </select>
            </div>

            <div id="customDateRange" style="display:none;">
                <div class="mb-3">
                    <label class="form-label">Desde:</label>
                    <input type="date" class="form-control" id="startDate">
                </div>
                <div class="mb-3">
                    <label class="form-label">Hasta:</label>
                    <input type="date" class="form-control" id="endDate">
                </div>
            </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary" onclick="updateChart()">Aplicar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="bmiInfoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fw-bold"><i class="bi bi-info-circle me-2"></i>Sobre el IMC</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">

        <h6 class="fw-bold text-dark">¿Qué es el IMC?</h6>
        <p class="text-muted small text-justify mb-2">
            El Índice de Masa Corporal (IMC) es una medida estándar utilizada internacionalmente para evaluar si una persona tiene un peso saludable en relación con su altura. Se calcula dividiendo el peso en kilogramos por el cuadrado de la altura en metros.
        </p>

        {% if current_bmi %}
        <div class="alert alert-primary d-flex align-items-center mb-4 border-0 shadow-sm rounded-3">
            <i class="bi bi-person-check-fill fs-3 me-2"></i>
            <div>
                <small class="text-uppercase fw-bold opacity-75" style="font-size: 0.7rem;">Tu Estado Actual</small>
                <div class="fw-bold fs-5">IMC {{ current_bmi }}</div>
            </div>
        </div>
        {% endif %}

        <h6 class="fw-bold text-dark mb-2">Clasificación OMS</h6>
        <div class="table-responsive">
            <table class="table table-sm table-borderless small align-middle mb-0">
                <thead class="bg-light text-secondary">
                    <tr>
                        <th class="ps-3 py-2 rounded-start">Categoría</th>
                        <th class="pe-3 py-2 rounded-end text-end">Rango IMC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="{% if current_bmi and current_bmi < 18.5 %}bg-info bg-opacity-10 fw-bold text-info border-start border-4 border-info{% endif %}">
                        <td class="ps-3 py-2">Bajo Peso</td>
                        <td class="pe-3 py-2 text-end">&lt; 18.5</td>
                    </tr>

                    <tr class="{% if current_bmi and current_bmi >= 18.5 and current_bmi < 25 %}bg-success bg-opacity-10 fw-bold text-success border-start border-4 border-success{% endif %}">
                        <td class="ps-3 py-2">Peso Normal</td>
                        <td class="pe-3 py-2 text-end">18.5 - 24.9</td>
                    </tr>

                    <tr class="{% if current_bmi and current_bmi >= 25 and current_bmi < 30 %}bg-warning bg-opacity-10 fw-bold text-warning border-start border-4 border-warning{% endif %}">
                        <td class="ps-3 py-2">Sobrepeso</td>
                        <td class="pe-3 py-2 text-end">25.0 - 29.9</td>
                    </tr>

                    <tr class="{% if current_bmi and current_bmi >= 30 and current_bmi < 35 %}bg-danger bg-opacity-10 fw-bold text-danger border-start border-4 border-danger{% endif %}">
                        <td class="ps-3 py-2">Obesidad Grado I</td>
                        <td class="pe-3 py-2 text-end">30.0 - 34.9</td>
                    </tr>

                    <tr class="{% if current_bmi and current_bmi >= 35 and current_bmi < 40 %}bg-danger bg-opacity-25 fw-bold text-danger border-start border-4 border-danger{% endif %}">
                        <td class="ps-3 py-2">Obesidad Grado II</td>
                        <td class="pe-3 py-2 text-end">35.0 - 39.9</td>
                    </tr>

                    <tr class="{% if current_bmi and current_bmi >= 40 %}bg-dark bg-opacity-10 fw-bold text-dark border-start border-4 border-dark{% endif %}">
                        <td class="ps-3 py-2">Obesidad Grado III</td>
                        <td class="pe-3 py-2 text-end">&ge; 40.0</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="mt-3 text-muted fst-italic text-center" style="font-size: 0.7rem;">
            * Fuente: Organización Mundial de la Salud (OMS)
        </div>

      </div>
      <div class="modal-footer border-0 pt-0">
        <button type="button" class="btn btn-primary w-100 rounded-pill" data-bs-dismiss="modal">Entendido</button>
      </div>
    </div>
  </div>
</div>